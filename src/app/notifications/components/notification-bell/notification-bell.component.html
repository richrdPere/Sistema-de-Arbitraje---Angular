<div class="dropdown dropdown-end" [class.dropdown-open]="dropdownOpen">
  <button class="btn btn-ghost btn-circle hover:bg-primary hover:text-white" (click)="toggleDropdown()">
    <div class="indicator">

      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>

      <!-- <i class="bi bi-bell text-xl"></i> -->
      @if (unread > 0) {

      <span class="badge badge-error badge-sm">{{ unread }}</span>
      }

    </div>
  </button>

  @if (dropdownOpen) {
  <div  class="mt-3 z-[100] card compact dropdown-content w-96 bg-base-100 shadow">
    <div class="card-body">
      <h3 class="card-title">Notificaciones
        <span class="text-sm ml-2 badge badge-outline">{{ notificaciones.length }}</span>
      </h3>

      @if (notificaciones.length === 0) {
      <div class="text-sm text-muted py-4">
        No tienes notificaciones.
      </div>
      }


      <div class="max-h-64 overflow-y-auto">
        @for (n of notificaciones; track $index) {
        <div class="px-2 py-2 border-b last:border-none">
          <div class="flex justify-between items-start">
            <div>
              <p class="font-medium" [ngClass]="{'opacity-60': n.leido}">{{ n.titulo }}</p>
              <p class="text-sm text-muted">{{ n.mensaje }}</p>
              <p class="text-xs text-muted">{{ n.createdAt | date:'short' }}</p>
            </div>

            <div class="flex flex-col items-end space-y-2">
              <button class="btn btn-xs btn-ghost" (click)="marcarLeido(n)">
                <i class="bi bi-check2"></i>
              </button>

              @if (n.tipo === 'designacion' && n.payload?.designacion_arbitro_id) {
              <div>
                <button class="btn btn-xs btn-success mb-1" (click)="aceptar(n)">Aceptar</button>
                <button class="btn btn-xs btn-error" (click)="rechazar(n)">Rechazar</button>
              </div>
              }

            </div>
          </div>
        </div>
        }

      </div>

      <div class="card-actions justify-end">
        <a class="btn btn-link btn-sm" routerLink="/notificaciones">Ver todas</a>
      </div>
    </div>
  </div>
  }
</div>
