<!-- Formulario con Steps para Mesa de Partes -->
<section class="relative w-full min-h-screen">
  <div class="relative min-h-screen bg-cover bg-center" style="background-image: url('assets/bg-justicia.jpg');
  ">

    <div class="absolute inset-0 bg-black/40 "></div>


    <div class="relative flex flex-col items-center justify-center min-h-screen px-6 py-8 ">


      <h1 class="text-center text-xs sm:text-xl md:text-3xl font-bold text-white mb-6">
        MESA DE PARTES VIRTUALES
      </h1>

      <div class="card w-full max-w-lg bg-base-200  shadow-xl p-6 ">
        <!-- STEPPER -->

        <div class="flex justify-between mb-6">
          <button class="btn w-1/3" [class.btn-active]="currentStep === 1" (click)="irAlPaso(1)">
            Demandante
          </button>
          <button class="btn w-1/3" [class.btn-active]="currentStep === 2" (click)="irAlPaso(2)">
            Demandado
          </button>
          <button class="btn w-1/3" [class.btn-active]="currentStep === 3" (click)="irAlPaso(3)">
            Solicitud
          </button>
        </div>



        <form [formGroup]="formTramiteMPV" (ngSubmit)="enviar()" class="space-y-6">
          <!-- STEP 1 ---------------------------------------------------------->
          @if (currentStep === 1) {
          <label class="label">
            <span class="label-text font-semibold text-xl text-info">Datos del Demandante</span>
          </label>

          <h2 class="text-sm font-semibold mb-4">Nombres y Apellidos</h2>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <input type="text" formControlName="nombre" placeholder="Nombres" class="input input-bordered w-full" />
            <input type="text" formControlName="apellidos" placeholder="Apellidos"
              class="input input-bordered w-full " />
          </div>


          <h2 class="text-sm font-semibold mb-4">Correo electrónico</h2>
          <div class="form-control mb-4 ">
            <input type="email" formControlName="correo" placeholder="Correo" class="input input-bordered w-full" />
          </div>

          <h2 class="text-sm font-semibold mb-4">Dirección</h2>
          <div class="form-control mb-4 ">
            <input type="text" formControlName="direccion" placeholder="Dirección"
              class="input input-bordered w-full " />
          </div>

          <h2 class="text-sm font-semibold mb-4">Teléfono</h2>
          <div class="form-control mb-4 ">
            <input type="text" formControlName="telefono" placeholder="Teléfono" class="input input-bordered w-full " />
          </div>

          <!-- <h2 class="text-sm font-semibold mb-4">Contraseña</h2>
          <div class="form-control mb-4 ">
            <input type="password" formControlName="password" placeholder="Contraseña"
              class="input input-bordered w-full " />
          </div> -->


          <h2 class="text-sm font-semibold mb-4">Documento de Identidad</h2>
          <div class="grid grid-cols-3 gap-3 mb-4">

            <!-- SELECT (1/3) -->
            <select formControlName="tipo_documento" class="select select-bordered w-full col-span-1 dropdown-bottom">
              <option value="" disabled selected>Tipo Documento</option>
              <option value="DNI">DNI</option>
              <option value="RUC">RUC</option>

            </select>

            <!-- INPUT (2/3) -->
            <input type="text" formControlName="documento_identidad" placeholder="Número de documento"
              class="input input-bordered w-full col-span-2" [maxlength]="maxDocumentoDemandante" />
          </div>
          }

          <!-- STEP 2 ---------------------------------------------------------->
          @if (currentStep === 2) {
          <label class="label">
            <span class="label-text font-semibold text-xl text-info">Datos del Demandado</span>
          </label>

          <!-- TIPO DE DEMANDADO -->
          <h2 class="text-sm font-semibold mb-4">Tipo de Demandado</h2>
          <div class="form-control mb-4">
            <select formControlName="tipo_demandado" (change)="onTipoDemandadoChange()"
              class="select select-bordered w-full">
              <option value="" disabled selected>Seleccione</option>
              <option value="persona">Persona Natural</option>
              <option value="entidad">Entidad / Institución</option>
            </select>
          </div>

          <!-- CUANDO ES ENTIDAD -->
          @if (isEntidad) {
          <h2 class="text-sm font-semibold mb-4">Nombre de la Entidad</h2>
          <div class="form-control mb-4">
            <input type="text" formControlName="nombre_demandado" placeholder="Nombre de la entidad"
              class="input input-bordered w-full" />
          </div>
          }

          <!-- CUANDO ES PERSONA -->
          @if (!isEntidad) {

          <h2 class="text-sm font-semibold mb-4">Nombres y Apellidos</h2>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <input type="text" formControlName="nombre_demandado" placeholder="Nombres"
              class="input input-bordered w-full" />
            <input type="text" formControlName="apellidos_demandado" placeholder="Apellidos"
              class="input input-bordered w-full " />
          </div>
          }

          <!-- CAMPOS COMUNES -->
          <h2 class="text-sm font-semibold mb-4">Correo electrónico</h2>
          <div class="form-control mb-4 ">
            <input type="email" formControlName="correo_demandado" placeholder="Correo"
              class="input input-bordered w-full" />
          </div>

          <h2 class="text-sm font-semibold mb-4">Dirección</h2>
          <div class="form-control mb-4 ">
            <input type="text" formControlName="direccion_demandado" placeholder="Dirección"
              class="input input-bordered w-full " />
          </div>

          <h2 class="text-sm font-semibold mb-4">Teléfono</h2>
          <div class="form-control mb-4 ">
            <input type="text" formControlName="telefono_demandado" placeholder="Teléfono"
              class="input input-bordered w-full " />
          </div>

          <h2 class="text-sm font-semibold mb-4">Documento de Identidad</h2>
          <div class="grid grid-cols-3 gap-3 mb-4">

            <!-- SELECT (1/3) -->
            <select formControlName="tipo_documento_demandado"
              class="select select-bordered w-full col-span-1 dropdown-bottom">
              <option value="" disabled selected>Tipo Documento</option>
              <option value="DNI">DNI</option>
              <option value="RUC">RUC</option>

            </select>

            <!-- INPUT (2/3) -->
            <input type="text" formControlName="doc_identidad_demandado" placeholder="Número de documento"
              class="input input-bordered w-full col-span-2" [maxlength]="maxDocumentoDemandante" />
          </div>
          }

          <!-- STEP 3 ---------------------------------------------------------->

          @if (currentStep === 3) {
          <label class="label">
            <span class="label-text font-semibold text-xl text-info">Datos del Arbitraje</span>
          </label>

          <h2 class="text-sm font-semibold mb-4">Tipo de arbitraje y codigo</h2>
          <div class="grid grid-cols-2 gap-3 mb-4">

            <select formControlName="tipo_solicitud" class="select select-bordered w-full">
              <option disabled selected>Seleccione un tipo...</option>
              <option value="Arbitraje de Emergencia">Arbitraje de Emergencia</option>
              <option value="Arbitraje Ad Hoc">Arbitraje Ad Hoc</option>
              <option value="Arbitraje Institucional">Arbitraje Institucional</option>
              <option value="Recusación de árbitro">Recusación de árbitro</option>
              <option value="Recusación de adjudicador">Recusación de adjudicador</option>
              <option value="Designación residual">Designación residual</option>
              <option value="Instalación de arbitraje">Instalación de arbitraje</option>
            </select>

            <input type="text" formControlName="codigo" class="input input-bordered w-full bg-gray-100" readonly />
          </div>


          <div>
            <h2 class="text-sm font-semibold mb-4">Descripción</h2>
            <textarea formControlName="descripcion" class="textarea textarea-bordered w-full"
              placeholder="Describa brevemente su solicitud..." rows="3"></textarea>
          </div>


          <div>
            <h2 class="text-sm font-semibold mb-4">Adjuntar archivos </h2>
            <input type="file" class="file-input file-input-bordered w-full" multiple
              (change)="onFileSelected($event)" />
          </div>

          }

          <!-- BOTONES DE NAVEGACIÓN -->

          <!-- MENSAJE DE ÉXITO -->
          <div class="flex justify-between pt-2">
            @if (currentStep > 1) {
            <button type="button" class="btn btn-outline" (click)="prevStep()">
              Atrás
            </button>
            }

            @if (currentStep < 3) { <button type="button" class="btn btn-primary ml-auto" (click)="nextStep()">
              Siguiente
              </button>
              }

              @if (currentStep === 3) {
              <button type="submit" class="btn btn-success ml-auto">
                <i class="fa-solid fa-paper-plane mr-2"></i> Registrar Solicitud
              </button>
              }


          </div>
        </form>

        @if (enviado) {
        <div class="mt-6">
          <div class="card bg-base-200 shadow-xl border border-gray-300">
            <div class="card-body">
              <h3 class="card-title text-success text-xl">
                <i class="fa-solid fa-circle-check mr-2"></i>
                Trámite registrado con éxito
              </h3>

              <p class="mt-3">
                <strong>Número de Trámite:</strong>
                <span class="badge badge-info text-white ml-2">
                  {{ respuesta.tramite.numero_tramite }}
                </span>
              </p>

              <p>
                <strong>Estado:</strong>
                <span class="badge badge-success text-white ml-2">
                  {{ respuesta.tramite.estado }}
                </span>
              </p>

              <p>

                <span class="badge badge-info text-white ml-2">Revise su correo por favor</span>
              </p>

            </div>
          </div>
        </div>
        }

        <!-- @if (enviado) {
        <div>
          <h3>Trámite registrado</h3>
          <p>Número: {{ respuesta.tramite.numero_tramite }}</p>
          <p>Estado: {{ respuesta.tramite.estado }}</p>
        </div>
        } -->

      </div>

    </div>
  </div>


</section>
