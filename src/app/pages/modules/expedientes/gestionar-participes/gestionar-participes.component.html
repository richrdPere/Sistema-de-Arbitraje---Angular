<div class="p-6">

  <h2 class="text-2xl font-bold mb-4">Gestionar Partícipes del Expediente</h2>

  <button class="btn btn-outline mb-4" (click)="router.navigate(['/secretaria/expedientes'])">
    ← Volver
  </button>

  @if (loading) {
  <div class="text-center py-10">
    <span class="loading loading-spinner loading-lg"></span>
  </div>
  } @else {

  <!-- INFORMACIÓN DEL EXPEDIENTE -->
  <div class="card bg-base-200 p-4 mb-6 shadow">
    <h3 class="font-semibold text-lg">Expediente {{ expediente?.numero_expediente }}</h3>
    <p><strong>Estado:</strong> {{ expediente?.estado }}</p>
    <p><strong>Inicio:</strong> {{ expediente?.fecha_inicio | date:'dd/MM/yyyy' }}</p>
  </div>

  <!-- PARTICIPES -->
  <div class="card bg-base-200 p-4 mb-6 shadow">
    <h3 class="font-semibold text-lg mb-2">Partícipes</h3>
    <ul class="list-disc ml-5">
      <li *ngFor="let p of participes">
        <strong>{{ p.rol_participe | uppercase }}:</strong>
        {{ p.usuario.nombre }} {{ p.usuario.apellidos }}
      </li>
    </ul>
  </div>

  <div class="p-4">

    <h2 class="text-xl font-bold mb-4">Designar Árbitros</h2>

    <!-- Tipo de designación -->
    <label class="font-semibold mb-2 block">Tipo de designación</label>
    <select class="select select-bordered w-full mb-4" [(ngModel)]="tipoSeleccionado" >

      <option value="" disabled>Seleccione</option>
      <option value="individual">Árbitro Único</option>
      <option value="tribunal">Tribunal Arbitral (3 árbitros)</option>
      <option value="aleatoria">Aleatoria</option>
    </select>

    <!-- Para arbitro único -->
    <div *ngIf="tipoSeleccionado === 'individual'">
      <label class="font-semibold">Árbitro único</label>
      <select class="select select-bordered w-full" [(ngModel)]="arbitroUnico">
        <option *ngFor="let a of arbitrosDisponibles" [value]="a.id">
          {{ a.nombre }}
        </option>
      </select>
    </div>

    <!-- Tribunal arbitral -->
    <div *ngIf="tipoSeleccionado === 'tribunal'" class="mt-4 space-y-3">

      <div>
        <label class="font-semibold">Árbitro del solicitante</label>
        <select class="select select-bordered w-full" [(ngModel)]="arbSolicitante">
          <option *ngFor="let a of arbitrosDisponibles" [value]="a.id">
            {{ a.nombre }}
          </option>
        </select>
      </div>

      <div>
        <label class="font-semibold">Árbitro del requerido</label>
        <select class="select select-bordered w-full" [(ngModel)]="arbRequerido">
          <option *ngFor="let a of arbitrosDisponibles" [value]="a.id">
            {{ a.nombre }}
          </option>
        </select>
      </div>

      <div>
        <label class="font-semibold">Árbitro institucional</label>
        <select class="select select-bordered w-full" [(ngModel)]="arbInstitucion">
          <option *ngFor="let a of arbitrosDisponibles" [value]="a.id">
            {{ a.nombre }}
          </option>
        </select>
      </div>

    </div>

    <button class="btn btn-primary w-full mt-6" (click)="guardarDesignacion()">
      Guardar Designación
    </button>
  </div>


  <!-- LISTA DE ÁRBITROS -->
  <div class="card bg-base-200 p-4 shadow">
    <h3 class="font-semibold text-lg mb-4">Seleccionar Árbitros</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      @for (arb of arbitrosDisponibles; track $index) {
      <div class="border p-3 rounded-lg flex items-center gap-3">

        <!-- Checkbox vinculado a arbitrosSeleccionados -->
        <input type="checkbox" class="checkbox checkbox-primary"
          [checked]="arbitrosSeleccionados.includes(arb.id_arbitro)" (change)="toggleArbitro(arb.id_arbitro)" />

        <div>
          <p class="font-semibold text-gray-700">
            {{ arb.usuario.nombre }} {{ arb.usuario.apellidos }}
          </p>
          <p class="text-sm text-gray-500">
            Especialidad: {{ arb.especialidad }}
          </p>
        </div>

      </div>
      }
    </div>

    <button class="btn btn-primary mt-6" (click)="guardarDesignacion()">
      Asignar Árbitros
    </button>
  </div>

  }

</div>

