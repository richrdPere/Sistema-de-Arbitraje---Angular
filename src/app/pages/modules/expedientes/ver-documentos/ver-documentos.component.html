<div class="p-6 min-h-full bg-base-300 text-base-content overflow-auto transition-colors duration-300">

  <!-- Link de regreso -->
  <a (click)="volver()" class="text-blue-600 hover:text-blue-800 flex items-center gap-2 mb-4">
    <i class="fa-solid fa-arrow-left"></i>
    Volver a Expedientes
  </a>


  <!-- Titulo -->
  <h1 class="text-2xl font-bold mb-5 text-base-content "> 游늯 Documentos del Expediente N춿 <span
      *ngIf="numeroExpediente">
      {{ numeroExpediente }}
    </span></h1>


  <div class="p-4 mb-7 card bg-base-100 shadow-md">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 py-4">

      <!--  BUSCADOR -->
      <div class="flex flex-col md:flex-row gap-4 items-center w-full md:w-auto">

        <!-- Input buscar -->
        <div class="relative w-full md:max-w-xs">
          <input type="text" class="input input-bordered w-full bg-base-100 rounded-md h-11 pl-10 pr-2 text-sm
                 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Buscar por titulo"
            [(ngModel)]="search" (input)="onFiltroChange()" />
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>

      </div>
    </div>

  </div>


  <!-- Modal Subir documento -->
  <subir-documentos [mostrarModal]="mostrarModal" [expedienteId]="expedienteSeleccionadoId"
    (modalCerrado)="cerrarModalDocumento()" (documentoSubido)="cargarDocumentos()"></subir-documentos>


  <!-- Tabla de documentos -->
  <div class="p-6 bg-base-100 rounded-xl shadow-xl">

    <div class="overflow-x-auto text-base-content border border-base-300/90 shadow rounded-lg">

      <!-- Header acciones -->
      <div class="flex justify-between items-center p-5">

        <!-- Selector de cantidad -->
        <div class="flex items-center gap-2 text-sm">
          <label>Mostrar:</label>

          <select class="select select-bordered select-sm w-auto" [(ngModel)]="limit" (change)="cambiarLimite()">
            <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
              {{ size }}
            </option>
          </select>

          <span>items por p치gina</span>
        </div>

        <!-- Bot칩n -->
        <div>
          <button class="btn btn-primary text-base-content hover:text-white bg-info hover:bg-primary border-none"
            (click)="abrirModal()">
            <i class="fa-solid fa-plus mr-1"></i>
            Documento
          </button>
        </div>
      </div>


      @if (loading) {

      <div class="text-gray-500">Cargando documentos...</div>
      }


      <!-- @if (!loading && documentos.length === 0) {
      <div class="text-gray-400">
        No hay documentos registrados.
      </div>
      } -->


      @if (!loading && documentos.length > 0) {
      <div class="overflow-x-auto bg-white shadow rounded-lg ">
        <table class="table w-full">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th>N춿</th>
              <th>Titulo</th>
              <th>Descripci칩n</th>
              <th>Fecha de Subida</th>

              <th>Tipo Documento</th>
              <th>Usuario</th>
              <th>Acci칩n</th>
            </tr>
          </thead>
          <tbody>

            @for (doc of documentos; track doc.id_documento; let i = $index) {
            <tr>
              <td>{{i + 1}}</td>
              <td>{{ doc.titulo }}</td>
              <td>{{ doc.descripcion }}</td>
              <td>{{ doc.createdAt | date: 'dd/MM/yyyy, h:mm a' }}</td>
              <td>{{ doc.tipo_documento }}</td>
              <td>{{ doc.usuario_id }}</td>

              <!-- Acciones -->
              <td class="text-right relative">
                <!-- <a [href]="doc.url_s3" target="_blank" class="text-blue-600 hover:underline">
                  Ver archivo
                </a> -->

                <!-- ACCIONES PRINCIPALES -->
                <div class="flex justify-start items-center gap-1">
                  <!-- Ver -->
                  <button class="btn btn-ghost btn-circle btn-md" title="Ver documento" (click)="verDocumento(doc)">
                    <i class="fa-solid fa-file"></i>
                  </button>

                  <!-- Editar -->
                  <!-- <button class="btn btn-ghost btn-circle btn-md" (click)="abrirModal('editar', user)">
                    <i class="fa-solid fa-pencil"></i>
                  </button> -->

                  <!-- Eliminar -->
                  <button class="btn btn-ghost btn-circle btn-md" title="Eliminar documento"
                    (click)="eliminarDocumento(doc.id_documento)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>

              </td>
            </tr>
            }

          </tbody>
        </table>

        <!-- Paginador -->
        <div class="flex justify-end items-center p-4 bg-base-300/90 text-sm">
          <span>
            P치gina {{ page }} de {{ totalPages }} registros
          </span>

          <div class="join ml-4 gap-2">
            <button class="join-item btn btn-sm" [disabled]="page === 1" (click)="cambiarPagina(page - 1)">
              Anterior
            </button>

            <button class="join-item btn btn-sm" [disabled]="page === totalItems" (click)="cambiarPagina(page + 1)">
              Siguiente
            </button>
          </div>
        </div>

      </div>

      }

      @else if (!loading && documentos.length === 0) {
      <div class="flex flex-col items-center justify-center my-20 text-center text-base-content/70">
        <img src="assets/img/empty-folder.png" alt="Sin solicitudes" class="w-40 h-40 mb-6 opacity-80" />
        <h3 class="text-lg font-semibold text-base-content mb-2">
          No hay documentos registrados.
        </h3>
        <p class="text-sm max-w-md">Suba los documentos relacionados al expediente.</p>
      </div>
      }
    </div>

  </div>



</div>
