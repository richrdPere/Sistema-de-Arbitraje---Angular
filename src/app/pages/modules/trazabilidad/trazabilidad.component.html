<div class="p-6 min-h-full bg-base-300 text-base-content overflow-auto transition-colors duration-300">

  <!-- Titulo -->
  <h1 class="text-2xl font-bold mb-5 text-base-content ">Trazabilidad de Expedientes Arbitrales</h1>

  <!-- Header -->
  <div class="card bg-base-100 shadow-md mb-7">

    <div class="p-6">

      <!-- CONTENEDOR PRINCIPAL -->
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">

        <!-- FILTROS -->
        <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">

          <!-- BUSCADOR -->
          <div class="relative w-full sm:w-96">
            <input type="text" class="input input-bordered w-full pl-10" placeholder="Buscar por c√≥digo de expediente"
              [(ngModel)]="filtroSearch" />
            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          </div>

          <!-- FILTRO ESTADO -->
          <select class="select select-bordered w-full sm:w-56" [(ngModel)]="filtroEstado">
            <option value="">Todos los estados</option>
            <option value="INICIADO">Iniciado</option>
            <option value="ARBITRO_DESIGNADO">√Årbitro designado</option>
            <option value="ACEPTADO">Aceptado</option>
            <option value="INSTALADO">Instalado</option>
            <option value="EN_TRAMITE">En tr√°mite</option>
            <option value="LAUDO_EMITIDO">Laudo emitido</option>
            <option value="CERRADO">Cerrado</option>
          </select>

        </div>
      </div>
    </div>
  </div>

  <!-- Modal de trazabilidad -->
  <ver-trazabilidad *ngIf="mostrarModal && expedienteId" [mostrarModal]="mostrarModal" [expedienteId]="expedienteId"
    (modalCerrado)="cerrarModal()"></ver-trazabilidad>


  <!-- Tabla -->

  <div class="p-6 min-h-auto bg-base-100 rounded-xl shadow-xl">

    <div class="overflow-x-auto text-base-content border border-base-300/90 shadow rounded-lg">

      <!-- Header acciones -->
      <div class="flex justify-between items-center p-5">

        <!-- Selector de cantidad -->
        <div class="flex items-center gap-2 text-sm">
          <label>Mostrar:</label>

          <select class="select select-bordered select-sm w-auto" [(ngModel)]="limit" (change)="cambiarLimite()">
            <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
              {{ size }}
            </option>
          </select>

          <span>items por p√°gina</span>
        </div>

        <!-- Bot√≥n -->
        <!-- <div>
          <button class="btn btn-primary text-base-content hover:text-white bg-info hover:bg-primary border-none"
            (click)="abrirModal()">
            <i class="fa-solid fa-plus mr-1"></i>
            Expediente
          </button>
        </div> -->

      </div>

      <!-- Tabla  -->
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th>#</th>
            <th>EXPEDIENTE</th>
            <th>PARTE</th>
            <th>ARBITROS</th>
            <th>ESTADO</th>
            <th>ESTADO PROCESAL</th>
            <th>ULTIMO MOVIMIENTO</th>
            <!-- <th>Documentos clave</th> -->
            <th>ACCIONES</th>
          </tr>
        </thead>

        <tbody>
          @if (loading) {
          <tr>
            <td colspan="7" class="text-center py-4 text-base-content/70">Cargando trazabilidad...</td>
          </tr>
          }

          @for (exp of expedientes; track exp.id_expediente; let i = $index) {
          <tr>
            <!-- Numeraci√≥n -->
            <td>{{i + 1}}</td>

            <!-- C√≥digo -->
            <td class="font-medium">
              {{ exp.numero_expediente }}
            </td>

            <!-- Partes -->
            <td>
              <div class="text-sm">
                <p><b>Demandante:</b> {{ exp.demandante }}</p>
                <p><b>Demandado:</b> {{ exp.demandado }}</p>
              </div>
            </td>

            <!-- √Årbitros -->
            <td>
              <ul class="text-xs space-y-1">
                @for (arb of exp.arbitros; track arb.nombre) {
                <li>
                  <span class="font-medium">{{ arb.nombre }}</span>
                  <span class="badge badge-outline ml-1">{{ arb.rol }}</span>
                </li>
                }
              </ul>
            </td>

            <!-- Estado -->
            <td>
              <span [class]="getBadgeEstado(exp.estado)">
                {{ exp.estado }}
              </span>
            </td>

            <!-- Estado Procesal -->
            <td>
              <span [class]="getBadgeEstadoProcesal(exp.estado_procesal)">
                {{ exp.estado_procesal }}
              </span>
            </td>

            <!-- √öltimo movimiento -->
            <td class="text-sm">
              <div class="flex flex-col gap-1">
                <span class="font-medium">
                  {{ exp.ultimoMovimiento }}
                </span>

                <span class="text-xs text-gray-500">
                  {{ exp.fechaUltimoMovimiento | date:'dd/MM/yyyy HH:mm' }}
                </span>

                <!-- Tooltip -->
                <span *ngIf="exp.detalleUltimoMovimiento" class="text-xs text-info cursor-help"
                  title="{{ exp.detalleUltimoMovimiento }}">
                  Ver detalle
                </span>
              </div>
            </td>

            <!-- Checklist documentos -->
            <!-- <td>
              <ul class="text-xs">
                <li>üìÑ Solicitud: {{ exp.tieneSolicitud ? '‚úîÔ∏è' : '‚ùå' }}</li>
                <li>‚öñÔ∏è Acta: {{ exp.tieneActa ? '‚úîÔ∏è' : '‚ùå' }}</li>
                <li>üìú Laudo: {{ exp.tieneLaudo ? '‚úîÔ∏è' : '‚ùå' }}</li>
              </ul>
            </td> -->

            <!-- Acciones -->
            <td class="text-right relative">

              <!-- ACCIONES PRINCIPALES -->
              <div class="flex justify-start items-center gap-1">

                <!-- Ver documentos -->
                <button class="btn btn-ghost btn-circle btn-md" title="Ver documentos" (click)="verDocumentos(exp)">
                  <i class="fa-solid fa-file-lines"></i>
                </button>

                <!-- Ver trazabilidad -->
                <button class="btn btn-ghost btn-circle btn-md" title="Ver trazabilidad" (click)="verTrazabilidad(exp)">
                  <i class="fa-solid fa-timeline"></i>
                </button>

              </div>
            </td>
          </tr>
          }

        </tbody>
      </table>

      @if (!loading && expedientes.length === 0) {
      <div class="flex flex-col items-center justify-center mt-20 text-center text-base-content/70">
        <img src="assets/img/empty-folder.png" alt="Sin solicitudes" class="w-40 h-40 mb-6 opacity-80" />
        <h3 class="text-lg font-semibold text-base-content mb-2">
          No hay expedientes registrados
        </h3>
        <p class="text-sm max-w-md">Cuando se registren nuevos expedientes, aparecer√°n aqu√≠ autom√°ticamente.</p>
      </div>}


    </div>

  </div>


</div>
