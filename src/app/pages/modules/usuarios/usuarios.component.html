<div class="p-6 min-h-full bg-base-300 text-base-content overflow-auto transition-colors duration-300">

  <!-- Titulo -->
  <h1 class="text-2xl font-bold mb-5 text-base-content ">Gestión de Usuarios</h1>


  <div class="p-4 mb-7 card bg-base-100 shadow-md">

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 py-4">

      <!--  BUSCADOR -->
      <div class="flex flex-col md:flex-row gap-4 items-center w-full md:w-auto">

        <!-- Select tipo ROL -->
        <select class="select select-bordered w-full md:w-60" [(ngModel)]="rolFiltro"
        (change)="onFiltroChange()">
          <!-- <option value="" disabled selected>Seleccione tipo</option> -->
          <option value="">TODOS</option>
          <option value="secretaria">SECRETARIA</option>
          <option value="arbitro">ARBITRO</option>
          <option value="adjudicador">ADJUDICADOR</option>
          <option value="admin">ADMINISTRADOR</option>
        </select>

        <!-- Input buscar -->
        <div class="relative w-full md:max-w-xs">
          <input
            type="text"
            class="input input-bordered w-full bg-base-100 rounded-md h-11 pl-10 pr-2 text-sm
                 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Buscar por nombres o DNI"
            [(ngModel)]="search" (input)="onFiltroChange()" />
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal -->
  <usuarios-form [mostrarModal]="mostrarModal" [modoEdicion]="modoEdicion" [usuarioSeleccionado]="usuarioSeleccionado"
    (modalCerrado)="cerrarModal()" (usuarioCreado)="cargarUsuarios()"></usuarios-form>


  <!-- Tabla -->
  <div class="p-6 bg-base-100 rounded-xl shadow-xl">

    <div class="overflow-x-auto text-base-content border border-base-300/90 shadow rounded-lg">

      <!-- Header acciones -->
      <div class="flex justify-between items-center p-5">

        <!-- Selector de cantidad -->
        <div class="flex items-center gap-2 text-sm">
          <label>Mostrar:</label>

          <select class="select select-bordered select-sm w-auto" [(ngModel)]="limit" (change)="cambiarLimite()">
            <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
              {{ size }}
            </option>
          </select>

          <span>items por página</span>
        </div>

        <!-- Botón -->
        <div>
          <button class="btn btn-primary text-base-content hover:text-white bg-info hover:bg-primary border-none"
            (click)="abrirModal()">
            <i class="fa-solid fa-plus mr-1"></i>
            Usuario
          </button>
        </div>
      </div>


      <!-- Tabla -->
      <table class="table w-full">
        <thead class="bg-base-300/90 text-base-content">
          <tr>
            <th>#</th>
            <th>USUARIO</th>
            <th>ROL</th>
            <th>CARGO</th>
            <th>CORREO ELECTRÓNICO</th>
            <th>DNI</th>
            <th>TÉLEFONO</th>
            <th>ESTADO</th>
            <th>ACCIONES</th>
          </tr>
        </thead>

        <tbody>

          <!-- Loading -->
          @if (loading) {
          <tr>
            <td colspan="7" class="text-center py-4">Cargando usuarios...</td>
          </tr>
          }

          <!-- Data -->
          @for (user of usuarios; track user.id) {
          <tr class="hover">
            <td>{{ (page - 1) * limit + $index + 1 }}</td>

            <!-- Nombres y apellidos -->
            <td>
              <div class="flex items-center gap-3">
                <div class="avatar">
                  <div class="mask mask-squircle h-12 w-12">
                    <img [src]="user.foto_perfil || 'assets/img/default-avatar.png'" alt="Avatar del usuario" />
                  </div>
                </div>
                <div>
                  <div class="font-bold">{{ user.nombre }}</div>
                  <div class="text-sm opacity-50">{{ user.apellidos }}</div>
                </div>
              </div>
            </td>

            <!-- Rol -->
            <td>
              <span class="badge badge-soft badge-info font-semibold">
                {{ user.rol | uppercase }}
              </span>
            </td>


            <!-- Cargo -->
            <td>
              {{ getCargoUsuario(user) }}
            </td>

            <!-- Correo -->
            <td>{{ user.correo }}</td>

            <!-- Documento de identidad -->
            <td>{{ user.documento_identidad }}</td>

            <!-- Teledono -->
            <td>{{ user.telefono }}</td>

            <!-- Estado -->
            <td>
              <input type="checkbox"
                class="toggle transition-all duration-200 bg-red-400 checked:bg-green-300 checked:text-success"
                [checked]="user.estado" [ngClass]="user.estado ? 'toggle-success' : 'toggle-error'"
                (click)="toggleEstadoUsuario(user, $event)" />

              <span class="text-sm ml-2" [ngClass]="user.estado ? 'text-success font-bold' : 'text-error font-bold'">
                {{ user.estado ? 'Activo' : 'Desactivado' }}
              </span>
            </td>

            <!-- Acciones -->
            <td class="text-right relative">

              <!-- ACCIONES PRINCIPALES -->
              <div class="flex justify-start items-center gap-1">
                <!-- Ver -->
                <button class="btn btn-ghost btn-circle btn-md" (click)="verUsuario(user)">
                  <i class="fa-solid fa-eye"></i>
                </button>

                <!-- Editar -->
                <button class="btn btn-ghost btn-circle btn-md" (click)="abrirModal('editar', user)">
                  <i class="fa-solid fa-pencil"></i>
                </button>

                <!-- Eliminar -->
                <button class="btn btn-ghost btn-circle btn-md" (click)="eliminarUsuario(user.id)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>

            </td>
          </tr>
          }

          <!-- Empty -->
          @if (!loading && usuarios.length === 0) {
          <tr>
            <td colspan="7" class="text-center text-gray-500 py-4">
              No se encontraron usuarios
            </td>
          </tr>
          }

        </tbody>
      </table>

      <!-- Paginador -->
      <div class="flex justify-end items-center p-4 bg-base-300/90 text-sm">
        <span>
          Página {{ page }} de {{ totalPages }} registros
        </span>

        <div class="join ml-4 gap-2">
          <button class="join-item btn btn-sm" [disabled]="page === 1" (click)="cambiarPagina(page - 1)">
            Anterior
          </button>

          <button class="join-item btn btn-sm" [disabled]="page === totalItems" (click)="cambiarPagina(page + 1)">
            Siguiente
          </button>
        </div>
      </div>

    </div>
  </div>

</div>
